# ‚òÅÔ∏è EC2 Apache Multi-Tenant Automation

### A Lightweight Hosting Environment for Students & Classrooms

images/architecture.png
------------------------------------------------------------------------

## üìñ Project Overview

This project automates onboarding and offboarding for students who need
simple personal web hosting on a shared EC2 server.

Using Bash scripts and Apache, the suite performs the following
automatically:

-   Creates a Linux user and home directory.\
-   Generates a minimal website (`index.html`) for the student.\
-   Configures an Apache VirtualHost that exposes the site on a
    dedicated port.\
-   Updates Apache to listen on the assigned port.\
-   Tracks actions in audit logs.\
-   Removes all artifacts on offboarding and frees the port for reuse.

The focus is on clear, auditable, and repeatable steps suitable for
classroom use.

------------------------------------------------------------------------

## üìë Table of Contents

-   [Network Architecture (AWS)](#1-network-architecture-aws)\
-   [Prerequisites](#2-prerequisites)\
-   [The Automation Suite](#3-the-automation-suite)\
-   [Example: Small Classroom
    Walkthrough](#4-example-small-classroom-walkthrough)\
-   [Under the Hood: Apache Config](#5-under-the-hood-apache-config)\
-   [Enabling Password Login](#6-enabling-password-login)\
-   [Conclusion](#7-conclusion)

------------------------------------------------------------------------

## 1. Network Architecture (AWS)

In AWS, configure the EC2 instance's Security Group (inbound rules) to
permit:

  Type         Port / Range   Who uses it
  ------------ -------------- ---------------------
  SSH          22             Admin only
  HTTP         80             Public landing page
  Custom TCP   8080--8090     Student site ports

**Recommendation:** Choose a port range that matches class size. For 10+
students expand the Custom TCP range (e.g., `8070‚Äì8090`).

------------------------------------------------------------------------

## 2. Prerequisites

On a fresh Ubuntu EC2 instance:

### **Step 1: Update packages and install Apache**

``` bash
sudo apt update
sudo apt install -y apache2
```

### **Step 2: Verify Apache is active**

``` bash
sudo systemctl status apache2
```

------------------------------------------------------------------------

## 3. The Automation Suite

Place the scripts in a `scripts/` folder in your repository.

------------------------------------------------------------------------

### **3.1 Onboarding --- `User_Create.sh`**

**Purpose:** Create a Linux user, generate a basic website, configure
Apache on a custom port, and log the operation.

**Actions performed:**

-   **Input:** Prompts admin for username, password, and port.\
-   **User Creation:** Creates system user with home directory
    `/var/www/<user>`.\
-   **Web Content:** Creates a default `index.html`.\
-   **Config:** Writes `/etc/apache2/sites-available/<user>.conf`.\
-   **Ports:** Adds `Listen <PORT>` to `/etc/apache2/ports.conf` if
    missing.\
-   **Activation:** Enables site and reloads Apache.\
-   **Logging:** Records event to `/var/log/user_onboarding.log`.

------------------------------------------------------------------------

### **3.2 Offboarding --- `User_Delete.sh`**

**Purpose:** Remove the student user, their files, and Apache config,
and free the port.

**Actions performed:**

-   **Input:** Prompts admin for the username and port to remove.\
-   **Cleanup:** Disables site, removes `.conf` file, and deletes the
    user/home directory.\
-   **Port Management:** Removes the `Listen <PORT>` line from
    `ports.conf`.\
-   **Logging:** Appends a `DELETED` status to the log file.

------------------------------------------------------------------------

## 4. Example: Small Classroom Walkthrough

### **Scenario:** Onboard student Bob on port `8081`.

#### **1. Run the Create Script:**

``` bash
sudo ./scripts/User_Create.sh
```

#### **2. Enter Details When Prompted:**

    Enter new username: bob
    Enter password: [hidden]
    Enter the Port number: 8081

#### **3. Verify:**

Open your browser:

üëâ `http://<EC2_PUBLIC_IP>:8081`

You should see:\
**"Welcome to bob's page"**

#### **4. Offboard Bob (End of Course):**

``` bash
sudo ./scripts/User_Delete.sh
```

When asked, enter:

    bob  
    8081  

------------------------------------------------------------------------

## 5. Under the Hood: Apache Config

Here is the VirtualHost template automatically generated by the
onboarding script:

    <VirtualHost *:<PORT>>
        DocumentRoot /var/www/<user>
        <Directory /var/www/<user>>
            Options Indexes FollowSymLinks
            AllowOverride All
            Require all granted
        </Directory>
    </VirtualHost>

------------------------------------------------------------------------

## 6. Enabling Password Login

By default, many EC2 images prefer keypair logins. For classroom
convenience, you may temporarily enable password authentication.

### Edit SSH config:

``` bash
sudo nano /etc/ssh/sshd_config.d/60-cloudimg-settings.conf
# or /etc/ssh/sshd_config on older images
```

### Set:

    PasswordAuthentication yes

### Restart SSH:

``` bash
sudo systemctl restart ssh
```

------------------------------------------------------------------------

## 7. Conclusion

This automation pattern allows instructors to provide scalable,
auditable student web environments from a single EC2 instance. The
scripts reduce repetitive administrative work, enforce consistent site
templates, and make it trivial to onboard and offboard students.
